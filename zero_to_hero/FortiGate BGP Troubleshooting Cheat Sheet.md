# FortiGate BGP Troubleshooting Cheat Sheet

| **Category**           | **Goal**                                                              | **FortiGate CLI Command**                                                                                   | **Common Troubleshooting Steps**                                                                                                                                |
| ---------------------- | --------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **BGP Session Status** | Check BGP neighbor status (State, Prefixes Rcvd, Up/Down Time)        | `get router info bgp summary`                                                                               | Peer state should be **Established**. Check for correct **AS Number** and **IP address** configuration if the state is **Idle** or **Active**.                  |
|                        | Get detailed neighbor info (Remote AS, Timers, Capabilities)          | `get router info bgp neighbors <neighbor_IP>`                                                               | Verify **password** (if used), **local-as**, **eBGP multihop** (if needed), and negotiated **capabilities**.                                                    |
| **Reachability**       | Check basic IP reachability to the peer                               | `execute ping <neighbor_IP>`                                                                                | If ping fails, troubleshoot **Layer 1/2/3** connectivity, **Interface Status**, **ARP table**, and **Firewall Policy** for TCP/179.                             |
|                        | Check TCP port 179 connectivity (BGP port)                            | `execute telnet <neighbor_IP> 179`                                                                          | If telnet fails, check for a **firewall policy** (Local-In or standard) allowing TCP/179 to the FortiGate's interface. Check if the remote peer is listening.   |
| **Routing Tables**     | Check BGP routes received, accepted, and active                       | `get router info bgp neighbors <neighbor_IP> routes`                                                        | Check **received-routes** (from peer) vs. **routes** (accepted into BGP table) to identify **prefix-list/route-map** issues.                                    |
|                        | View all BGP routes (Active/Inactive) in the BGP table                | `get router info routing-table bgp`                                                                         | Verify expected prefixes are present and marked with the **B** (BGP) origin code.                                                                               |
|                        | View the main active kernel routing table (FIB)                       | `get router info routing-table all`                                                                         | Ensure the desired BGP routes are the **best path** (B) and have been installed in the kernel (FIB) for forwarding.                                             |
|                        | Check advertised routes to a peer                                     | `get router info bgp neighbors <neighbor_IP> advertised-routes`                                             | If routes are missing, check **redistribute** settings and **outbound route-maps/prefix-lists**.                                                                |
| **Debugging**          | Enable verbose BGP daemon logs (Info level is key)                    | `diagnose ip router bgp level info`<br>`diagnose ip router bgp all enable`<br>`diagnose debug enable`       | Look for clues like AS mismatch, authentication failure, or protocol errors in the debug output. Use `diagnose debug disable` / `diagnose debug reset` to stop. |
|                        | Capture BGP packets on port 179                                       | `diagnose sniffer packet any "port 179" 4`                                                                  | Verify the **SYN/SYN-ACK/ACK** handshake and **BGP OPEN** message exchange. Look for TCP resets (RST) indicating issues like AS mismatch or authentication.     |
|                        | Trace BGP session setup traffic flow (for firewall policy/NAT issues) | `diagnose debug flow filter dport 179`<br>`diagnose debug flow trace start 100` <br>`diagnose debug enable` | Check if traffic is hitting the expected **firewall policy** or being dropped by **iprope** (internal policy).                                                  |
| **Maintenance**        | Clear all BGP peer sessions (temporarily drops connections)           | `execute router clear bgp all`                                                                              | Use to force a **re-negotiation** after configuration changes or to stop route flapping temporarily.                                                            |
|                        | Clear a specific BGP neighbor session                                 | `execute router clear bgp ip <neighbor_IP>`                                                                 | Clear only the session that has been changed or is experiencing issues.                                                                                         |
